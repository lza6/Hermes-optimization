# 🌌 Hermes AI Gateway (v5.0 COSMIC-GENESIS)

> **"让 AI 触手可及，让计算回归自由。"**  
> 这不仅是一个 API 网关，它是连接全球 AI 算力的神经网络。基于 Apache 2.0 开源协议。

---

## 🌟 项目灵魂：它能带给你什么？

在 API 时代，开发者面临的是碎片化的供应商、不稳定的网络、繁琐的人机校验以及难以捉摸的成本。**Hermes-optimization** 就是为了终结这一切而生。

-   **💪 作用与好处**：
    -   **极简接入**：无论你有 1 个还是 100 个 OpenAI 兼容供应商，对外只暴露一个标准接口。
    -   **极致稳定**：供应商挂了？它自动重试；供应商慢了？它自动降级；供应商被人机验证卡了？它自动绕过。
    -   **成本优化**：通过智能调度，优先选择性价比最高、最稳定的线路。
-   **⚠️ 现状与不足 (诚实告白)**：
    -   目前主要针对 OpenAI 协议，对其他非标准协议支持较弱。
    -   数据库目前使用分布式较难的 SQLite，虽然轻量但非多机共享。
    -   **优点**：极致性能、全自动化、小白友好、开源免费。
    -   **缺点**：功能还在飞速迭代，部分高级扩展需要你会一点点 Python。

---

## 🚀 懒人一键安装 (Windows 专属福利)

不管你是代码小白还是技术大牛，只需一步即可起飞：

1.  **下载仓库**：点击 GitHub 的 `Download ZIP` 或运行 `git clone https://github.com/lza6/Hermes-optimization`。
2.  **双击运行**：在文件夹中找到 `start.bat`，双击它！
3.  **大功告成**：脚本会自动帮你安装 Python 环境、下载所有依赖，并自动在浏览器打开控制面板 (`http://localhost:8000/dashboard`)。

> [!TIP]
> **这就像是在微波炉热饭一样简单。** 剩下的交给 Hermes，你只需要专注于你的 AI 创意。

---

## 🧠 技术原理图：它是如何工作的？

Hermes 的核心是一套高精度、全异步的转发与反馈反馈回路。

### 1. 贝叶斯路由算法 (Thompson Sampling)
我们拒绝简单的轮询。Hermes 内部运行着一套基于 **Beta 分布** 的数学模型：
-   **Alpha (α)**：记录成功次数。
-   **Beta (β)**：记录失败次数。
每一次请求，算法都会从概率分布中进行“抽样”。成功率高、延迟低的节点会自然获得更高权重。
> **大白话**：它会像一个老伙计一样，记住谁更靠谱，悄悄把活交给最快、最稳的人。

### 2. 三态断路器 (Circuit Breaker)
防止“雪崩效应”。
-   **Closed**：一切正常。
-   **Open**：供应商彻底失效，直接熔断 30 分钟，不浪费一个字节去尝试。
-   **Half-Open**：冷却结束后，尝试发一个探测请求看看恢复没。

### 3. 高级伪装技术 (Headless / Anti-Detection)
集成无头浏览器伪装与反检测逻辑，能够自动化模拟真实用户行为，绕过 **CF (Cloudflare)** 和 **Vercel** 的人机盾牌，确保 API 调用不再被 403 阻断。

---

## 📂 文件结构：AI 爬虫视角蓝图

为了方便开发者和 AI 助手（如 Gemini/Copilot/Claude）快速定位逻辑，以下是项目的完整地图：

```text
Hermes-optimization/
├── hermes/                     # 核心代码
│   ├── main.py                 # 🚀 心脏：FastAPI 应用入口
│   ├── database.py             # 💾 持久化：SQLite 连接池
│   ├── controllers/            # 🎮 指挥室：处理 API 请求路由
│   ├── services/               # ⚙️ 实验室：最核心的技术源头
│   │   ├── proxy_service.py    # 代理转发 & HTTP/2 多路复用
│   │   ├── dispatcher_service.py # 智能调度 & 冷却惩罚逻辑
│   │   ├── routing_score_service.py # 🌟 灵魂：贝叶斯/EWMA 算法实现
│   │   └── circuit_breaker.py  # 🛡️ 护盾：熔断保护机制
│   ├── templates/              # 🎨 颜控：极简而美的 Dashboard
│   └── utils/                  # 🛠️ 工具箱：模型规范化与日志
├── project_specs.md            # 📜 规格书：记录所有细节演进
└── start.bat                   # ⚡ 闪电：一键启动脚本
```

---

## 🛠️ 为开发者准备的扩展指南

你想大显身手吗？这里有无限可能：

1.  **扩展算法**：在 `routing_score_service.py` 中引入遗传算法或协同过滤。
2.  **多租户支持**：在 `auth_service.py` 中接入更高级的 API Key 分配逻辑。
3.  **UI/UX 升级**：修改 `templates/dashboard.html`，加入 Vanta.js 打造更酷炫的背景。
4.  **适配新协议**：在 `proxy_service.py` 中增加对 Anthropic 或 Google Gemini 原生协议的支持。

---

## 🌈 价值观与哲学

开源不仅仅是代码的分享，更是**信任的传递**。
Hermes 坚信：**“复杂性应当留在后端，而优雅应当留给用户。”** 
如果你在用完这个工具后，感叹一句“原来搞 AI 代理也没那么难，我也可以动手改一改”，那么这个项目的目标就达到了。我们鼓励每个人参与到开源中来，用代码的力量去回馈社区，建立正确、开放、进取的价值观。

---

## 🔮 未来蓝图 (V6.0 展望)

- [ ] **实时 WebSocket 推送**：响应速度实时在仪表盘跳动。
- [ ] **分布式部署支持**：支持 MySQL/PostgreSQL 替代 SQLite。
- [ ] **多层级限流**：支持按用户、按模型、按分钟的分层配额控。
- [ ] **自动训练**：根据历史日志自动微调路由参数。

---

**本项目由热爱开源的开发者倾心打造。如果你觉得有收获，请点一个 Star！⭐**
**欢迎提交 Pull Request，让我们一起建设更完美的 Hermes！**
